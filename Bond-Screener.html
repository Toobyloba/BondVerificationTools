<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bond Screener</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/global.css">
    <style>
        .page-header {
            background: var(--primary-gradient);
            color: white;
            padding: 3rem 0;
            margin-bottom: 3rem;
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
            text-align: center;
        }

        .step-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 2rem 0 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border);
            color: var(--primary);
        }

        .step-number {
            background: var(--primary);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 700;
        }

        .checkpoint-card {
            background: white;
            padding: 1.5rem;
            border-radius: var(--radius);
            margin-bottom: 1rem;
            border-left: 6px solid #e5e7eb;
            box-shadow: var(--shadow);
            display: flex;
            gap: 1.5rem;
            transition: var(--transition);
        }

        .checkpoint-card.pass {
            border-left-color: var(--success);
        }

        .checkpoint-card.fail {
            border-left-color: var(--error);
        }

        .checkpoint-card.warning {
            border-left-color: var(--warning);
        }

        .checkpoint-icon-wrapper {
            font-size: 1.5rem;
            width: 48px;
            height: 48px;
            background: #f3f4f6;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .decision-banner {
            margin-top: 3rem;
            padding: 2rem;
            border-radius: var(--radius-lg);
            text-align: center;
            color: white;
        }

        .decision-banner.buy {
            background: var(--success);
        }

        .decision-banner.reject {
            background: var(--error);
        }

        .metric-pill {
            background: white;
            padding: 1rem;
            border-radius: var(--radius);
            text-align: center;
            border: 1px solid var(--border);
        }

        .metric-pill .label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 0.25rem;
        }

        .metric-pill .value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
        }
    </style>
</head>

<body>
    <div class="page-header">
        <div class="container">
            <h1 style="color: white; margin-bottom: 0.5rem;">Bond Screener</h1>
            <p style="opacity: 0.9;">Professional Bond Evaluation Framework</p>
        </div>
    </div>

    <div class="container" style="padding-top: 0;">
        <div class="grid grid-cols-2">
            <!-- Step 0: Bond Static Data -->
            <div class="card">
                <h3 class="card-title">Core Bond Data</h3>
                <div class="form-group">
                    <label>Face Value (F) - $</label>
                    <input type="number" id="faceValue" value="1000">
                </div>
                <div class="form-group">
                    <label>Current Market Price (P) - $</label>
                    <input type="number" id="marketPrice" value="950">
                </div>
                <div class="form-group">
                    <label>Coupon Rate (c) - %</label>
                    <input type="number" id="couponRate" value="5">
                </div>
                <div class="form-group">
                    <label>Coupon Type</label>
                    <select id="couponType">
                        <option value="fixed">Fixed</option>
                        <option value="floating">Floating</option>
                        <option value="zero">Zero-Coupon</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Years to Maturity (n)</label>
                    <input type="number" id="yearsToMaturity" value="10">
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">Risk Parameters</h3>
                <div class="grid grid-cols-2">
                    <div class="form-group">
                        <label>Expected Inflation - %</label>
                        <input type="number" id="inflation" value="2.5">
                    </div>
                    <div class="form-group">
                        <label>Risk-Free YTM - %</label>
                        <input type="number" id="riskFreeYTM" value="4">
                    </div>
                </div>
                <div class="form-group">
                    <label>Bond Rating</label>
                    <select id="bondRating">
                        <option>AAA</option>
                        <option>AA</option>
                        <option>A</option>
                        <option selected>BBB</option>
                        <option>BB</option>
                        <option>B</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Hold Period (yrs)</label>
                    <input type="number" id="holdingPeriod" value="5">
                </div>
                <div class="grid grid-cols-2">
                    <div class="form-group">
                        <label>FX Deprec. - %</label>
                        <input type="number" id="currencyDepreciation" value="0">
                    </div>
                    <div class="form-group">
                        <label>Home Inflation - %</label>
                        <input type="number" id="homeInflation" value="2.5">
                    </div>
                </div>
            </div>
        </div>

        <div class="card" style="margin-top: 1.5rem;">
            <h3 class="card-title">Liquidity & Features</h3>
            <div class="grid grid-cols-2">
                <div class="form-group">
                    <label>Is Bond Callable?</label>
                    <select id="isCallable">
                        <option value="false">No</option>
                        <option value="true">Yes</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Daily Volume ($M)</label>
                    <input type="number" id="tradingVolume" value="5">
                </div>
            </div>
        </div>

        <button onclick="evaluateBond()" class="btn btn-primary"
            style="margin-top: 2rem; width: 100%; height: 60px; font-size: 1.125rem;">
            Run Full Evaluation
        </button>

        <div class="results-section" id="resultsSection" style="display: none;">
            <h2 style="font-size: 1.5rem; margin-top: 2rem;">Analysis Summary</h2>
            <div id="metricsContainer" class="grid grid-cols-3" style="margin-bottom: 2rem;"></div>

            <div id="errorContainer"></div>

            <div class="step-header">
                <div class="step-number">1</div>
                <h3 style="margin: 0; font-size: 1.125rem;">Core Yield Analysis</h3>
            </div>
            <div id="step1Results"></div>

            <div class="step-header">
                <div class="step-number">2</div>
                <h3 style="margin: 0; font-size: 1.125rem;">Inflation Protection</h3>
            </div>
            <div id="step2Results"></div>

            <div class="step-header">
                <div class="step-number">3</div>
                <h3 style="margin: 0; font-size: 1.125rem;">Interest Rate Risk</h3>
            </div>
            <div id="step3Results"></div>

            <div class="step-header">
                <div class="step-number">4</div>
                <h3 style="margin: 0; font-size: 1.125rem;">Credit Risk Assessment</h3>
            </div>
            <div id="step4Results"></div>

            <div class="step-header">
                <div class="step-number">5</div>
                <h3 style="margin: 0; font-size: 1.125rem;">Currency Risk Assessment</h3>
            </div>
            <div id="step5Results"></div>

            <div class="step-header">
                <div class="step-number">6</div>
                <h3 style="margin: 0; font-size: 1.125rem;">Liquidity & Provisions</h3>
            </div>
            <div id="step6Results"></div>

            <div id="decisionBox"></div>
        </div>

        <div style="height: 100px;"></div>
    </div>

    <script src="js/api-client.js"></script>
    <script>
        function createCheckpoint(title, passed, detail) {
            const status = passed ? 'pass' : 'fail';
            const icon = passed ? '✅' : '❌';
            return `
                <div class="checkpoint-card ${status} animate-fade-in">
                    <div class="checkpoint-icon-wrapper">${icon}</div>
                    <div>
                        <div style="font-weight: 700; color: var(--text); margin-bottom: 0.25rem;">${title}</div>
                        <div style="font-size: 0.875rem; color: var(--text-muted); line-height: 1.5;">${detail}</div>
                    </div>
                </div>
            `;
        }

        async function evaluateBond() {
            const resultsSection = document.getElementById('resultsSection');
            const errorContainer = document.getElementById('errorContainer');
            const btn = document.querySelector('button[onclick="evaluateBond()"]');

            errorContainer.innerHTML = '';
            btn.disabled = true;
            btn.innerHTML = '<span>Processing Engine...</span>';

            try {
                const data = {
                    faceValue: parseFloat(document.getElementById('faceValue').value),
                    marketPrice: parseFloat(document.getElementById('marketPrice').value),
                    couponRate: parseFloat(document.getElementById('couponRate').value),
                    yearsToMaturity: parseFloat(document.getElementById('yearsToMaturity').value),
                    inflation: parseFloat(document.getElementById('inflation').value),
                    riskFreeYTM: parseFloat(document.getElementById('riskFreeYTM').value),
                    currencyDepreciation: parseFloat(document.getElementById('currencyDepreciation').value),
                    homeInflation: parseFloat(document.getElementById('homeInflation').value),
                    holdingPeriod: parseFloat(document.getElementById('holdingPeriod').value),
                    isCallable: document.getElementById('isCallable').value === 'true',
                    tradingVolume: parseFloat(document.getElementById('tradingVolume').value),
                    bondRating: document.getElementById('bondRating').value
                };

                const result = await BondAPI.evaluateScreener(data);

                if (result.immediateReject) {
                    document.getElementById('step1Results').innerHTML = createCheckpoint('YTM Check', false, result.reason);
                    document.getElementById('decisionBox').innerHTML = `
                        <div class="decision-banner reject animate-fade-in">
                            <h2 style="color: white; margin-bottom: 0.5rem;">REJECT</h2>
                            <p style="opacity: 0.9;">${result.reason}</p>
                        </div>
                    `;
                    resultsSection.style.display = 'block';
                    resultsSection.scrollIntoView({ behavior: 'smooth' });
                    return;
                }

                const { metrics, checkpoints, decision } = result;

                // Metrics summary
                document.getElementById('metricsContainer').innerHTML = `
                    <div class="metric-pill"><div class="label">Current Yield</div><div class="value">${(metrics.currentYield * 100).toFixed(2)}%</div></div>
                    <div class="metric-pill"><div class="label">YTM</div><div class="value">${(metrics.ytm * 100).toFixed(2)}%</div></div>
                    <div class="metric-pill"><div class="label">Real Yield</div><div class="value">${(metrics.realYield * 100).toFixed(2)}%</div></div>
                    <div class="metric-pill"><div class="label">Duration</div><div class="value">${metrics.duration.toFixed(2)}y</div></div>
                    <div class="metric-pill"><div class="label">Credit Spread</div><div class="value">${(metrics.creditSpread * 100).toFixed(2)}%</div></div>
                    <div class="metric-pill"><div class="label">FX Adjusted</div><div class="value">${(metrics.realReturnHome * 100).toFixed(2)}%</div></div>
                `;

                document.getElementById('step1Results').innerHTML = createCheckpoint('Current Yield', checkpoints.cy.passed, checkpoints.cy.detail) + createCheckpoint('Yield to Maturity', checkpoints.ytm.passed, checkpoints.ytm.detail);
                document.getElementById('step2Results').innerHTML = createCheckpoint('Real Yield Protection', checkpoints.ry.passed, checkpoints.ry.detail);
                document.getElementById('step3Results').innerHTML = createCheckpoint('Macaulay Duration', checkpoints.duration.passed, checkpoints.duration.detail) + createCheckpoint('Hold Period Alignment', checkpoints.holdingPeriod.passed, checkpoints.holdingPeriod.detail);
                document.getElementById('step4Results').innerHTML = createCheckpoint('Rating Alignment', checkpoints.creditSpread.passed, checkpoints.creditSpread.detail);
                document.getElementById('step5Results').innerHTML = createCheckpoint('Home Currency Return', checkpoints.currencyRisk.passed, checkpoints.currencyRisk.detail);
                document.getElementById('step6Results').innerHTML = createCheckpoint('Callability Risk', checkpoints.callability.passed, checkpoints.callability.detail) + createCheckpoint('Market Liquidity', checkpoints.liquidity.passed, checkpoints.liquidity.detail);

                const bannerClass = decision === 'BUY' ? 'buy' : 'reject';
                document.getElementById('decisionBox').innerHTML = `
                    <div class="decision-banner ${bannerClass} animate-fade-in">
                        <h2 style="color: white; margin-bottom: 0.5rem;">${decision}</h2>
                        <p style="opacity: 0.9;">${decision === 'BUY' ? 'This bond meets all institutional-grade criteria.' : 'Analysis revealed critical risk factors. Proceed with caution.'}</p>
                    </div>
                `;

                resultsSection.style.display = 'block';
                resultsSection.scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                errorContainer.innerHTML = `<div class="badge badge-error" style="display: block; padding: 1rem;">Server Error: ${error.message}</div>`;
                resultsSection.style.display = 'block';
            } finally {
                btn.disabled = false;
                btn.innerText = 'Run Full Evaluation';
            }
        }
    </script>
</body>

</html>