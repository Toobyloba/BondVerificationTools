<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bond Screener Pro - Corrected Framework</title>
    <style>
        :root {
            --color-primary: #208091;
            --color-success: #2db566;
            --color-warning: #f59e0b;
            --color-error: #e84444;
            --color-bg: #f8f8f6;
            --color-surface: #fff;
            --color-text: #1a1a19;
            --color-text-secondary: #666;
            --color-border: #e0e0dd;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 32px;
            border-bottom: 2px solid var(--color-border);
            padding-bottom: 16px;
        }

        h1 {
            margin: 0 0 8px 0;
            font-size: 28px;
            font-weight: 600;
        }

        .subtitle {
            color: var(--color-text-secondary);
            font-size: 14px;
            margin: 0;
        }

        .notice {
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid var(--color-warning);
            padding: 12px;
            border-radius: 4px;
            font-size: 13px;
            margin-top: 12px;
            color: var(--color-text);
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 24px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 20px;
        }

        .card-title {
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--color-text-secondary);
            margin: 0 0 16px 0;
            letter-spacing: 0.5px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--color-text);
        }

        input, select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            font-size: 14px;
            background: var(--color-surface);
            color: var(--color-text);
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 2px rgba(32, 128, 145, 0.1);
        }

        button {
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background 150ms;
        }

        button:hover {
            background: #1a6a78;
        }

        button:active {
            background: #155a68;
        }

        .results-section {
            margin-top: 32px;
        }

        .score-header {
            background: var(--color-surface);
            border: 2px solid var(--color-primary);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 24px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .score-item {
            text-align: center;
        }

        .score-label {
            font-size: 12px;
            text-transform: uppercase;
            color: var(--color-text-secondary);
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .score-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--color-primary);
            font-family: monospace;
        }

        .step-section {
            margin-bottom: 24px;
        }

        .step-title {
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--color-text-secondary);
            letter-spacing: 0.5px;
            margin: 24px 0 12px 0;
        }

        .criterion {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .criterion-icon {
            font-size: 24px;
            flex-shrink: 0;
            margin-top: 0px;
        }

        .criterion.green {
            border-left: 4px solid var(--color-success);
            background: rgba(45, 181, 102, 0.05);
        }

        .criterion.yellow {
            border-left: 4px solid var(--color-warning);
            background: rgba(245, 158, 11, 0.05);
        }

        .criterion.red {
            border-left: 4px solid var(--color-error);
            background: rgba(232, 68, 68, 0.05);
        }

        .criterion-content {
            flex: 1;
        }

        .criterion-title {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .criterion-detail {
            font-size: 13px;
            color: var(--color-text-secondary);
            margin-bottom: 4px;
        }

        .criterion-formula {
            font-size: 12px;
            background: rgba(0, 0, 0, 0.02);
            padding: 8px;
            border-radius: 4px;
            font-family: monospace;
            margin-top: 6px;
            color: #555;
        }

        .criterion-score {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .decision-box {
            background: var(--color-surface);
            border: 2px solid var(--color-border);
            border-radius: 8px;
            padding: 24px;
            margin-top: 24px;
            text-align: center;
        }

        .decision-box.buy {
            border-color: var(--color-success);
            background: rgba(45, 181, 102, 0.05);
        }

        .decision-box.buy .decision-title {
            color: var(--color-success);
            font-size: 28px;
            font-weight: 700;
            margin: 0;
        }

        .decision-box.hold {
            border-color: var(--color-warning);
            background: rgba(245, 158, 11, 0.05);
        }

        .decision-box.hold .decision-title {
            color: var(--color-warning);
            font-size: 28px;
            font-weight: 700;
            margin: 0;
        }

        .decision-box.reject {
            border-color: var(--color-error);
            background: rgba(232, 68, 68, 0.05);
        }

        .decision-box.reject .decision-title {
            color: var(--color-error);
            font-size: 28px;
            font-weight: 700;
            margin: 0;
        }

        .decision-subtitle {
            font-size: 13px;
            color: var(--color-text-secondary);
            margin-top: 8px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            margin-bottom: 24px;
        }

        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .metric {
            background: rgba(0, 0, 0, 0.02);
            padding: 12px;
            border-radius: 6px;
            font-size: 12px;
        }

        .metric-label {
            color: var(--color-text-secondary);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .metric-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--color-text);
            font-family: monospace;
        }

        .error-message {
            background: rgba(232, 68, 68, 0.1);
            color: var(--color-error);
            padding: 12px;
            border-radius: 6px;
            font-size: 13px;
            margin-bottom: 16px;
            border-left: 4px solid var(--color-error);
        }

        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .score-breakdown {
            background: rgba(0, 0, 0, 0.02);
            padding: 12px;
            border-radius: 6px;
            font-size: 12px;
            margin-top: 12px;
        }

        .score-breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .score-breakdown-item:last-child {
            border-bottom: none;
        }

        .score-breakdown-total {
            font-weight: 600;
            border-top: 2px solid rgba(0, 0, 0, 0.1);
            padding-top: 8px;
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Bond Screener Pro</h1>
            <p class="subtitle">Corrected 7-step evaluation framework with weighted scoring (Green=2, Yellow=1, Red=0)</p>
            <div class="notice">
                ‚ö†Ô∏è This tool corrects logical inconsistencies in the original framework. Credit Risk (Step 5) and fundamental yield metrics are weighted higher than liquidity.
            </div>
        </header>

        <div class="grid">
            <!-- Step 1: Bond Data -->
            <div class="card">
                <h3 class="card-title">Step 1: Bond Essentials</h3>
                <div class="form-group">
                    <label>Bond Price (Current Market) - $</label>
                    <input type="number" id="bondPrice" value="950" min="1" step="10">
                </div>
                <div class="form-group">
                    <label>Face Value (Par) - $</label>
                    <input type="number" id="faceValue" value="1000" min="1" step="100">
                </div>
                <div class="form-group">
                    <label>Coupon Rate - %</label>
                    <input type="number" id="couponRate" value="5" min="0" step="0.1">
                </div>
                <div class="form-group">
                    <label>Coupon Type</label>
                    <select id="couponType">
                        <option value="fixed">Fixed</option>
                        <option value="floating">Floating</option>
                        <option value="zero">Zero-Coupon</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Years to Maturity</label>
                    <input type="number" id="yearsToMaturity" value="5" min="0.1" step="0.1">
                </div>
                <div class="form-group">
                    <label>Credit Rating</label>
                    <select id="creditRating">
                        <option>AAA</option>
                        <option>AA</option>
                        <option>A</option>
                        <option>BBB</option>
                        <option>BB</option>
                        <option>B</option>
                    </select>
                </div>
            </div>

            <!-- Step 2-6: Market Context -->
            <div class="card">
                <h3 class="card-title">Steps 2-6: Market Context</h3>
                <div class="form-group">
                    <label>Yield to Maturity (YTM) - %</label>
                    <input type="number" id="ytm" value="6" min="0" step="0.1">
                </div>
                <div class="form-group">
                    <label>Current Yield - %</label>
                    <input type="number" id="currentYield" value="5.26" min="0" step="0.1">
                </div>
                <div class="form-group">
                    <label>Risk-Free (Treasury) YTM - %</label>
                    <input type="number" id="treasuryYTM" value="4" min="0" step="0.1">
                </div>
                <div class="form-group">
                    <label>Expected Inflation - %</label>
                    <input type="number" id="inflation" value="2.5" min="0" step="0.1">
                </div>
                <div class="form-group">
                    <label>Duration (years)</label>
                    <input type="number" id="duration" value="4.5" min="0.1" step="0.1">
                </div>
                <div class="form-group">
                    <label>Your Holding Period (years)</label>
                    <input type="number" id="holdingPeriod" value="5" min="0.1" step="0.1">
                </div>
            </div>
        </div>

        <!-- Fine Print -->
        <div class="card">
            <h3 class="card-title">Step 6: Fine Print</h3>
            <div class="two-col">
                <div class="form-group">
                    <label>Is Bond Callable?</label>
                    <select id="isCallable">
                        <option value="false">No</option>
                        <option value="true">Yes</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Daily Trading Volume - $ millions</label>
                    <input type="number" id="tradingVolume" value="5" min="0" step="0.1">
                </div>
            </div>
        </div>

        <button onclick="evaluateBond()" style="margin-top: 24px; width: 100%; padding: 14px; font-size: 16px;">
            Run Evaluation
        </button>

        <!-- Results -->
        <div class="results-section" id="resultsSection" style="display: none;">
            <div id="errorContainer"></div>

            <div class="score-header">
                <div class="score-item">
                    <div class="score-label">Total Score</div>
                    <div class="score-value" id="totalScore">--</div>
                </div>
                <div class="score-item">
                    <div class="score-label">Maximum Possible</div>
                    <div class="score-value">14</div>
                </div>
            </div>

            <div id="metricsContainer"></div>

            <!-- Step 2: Price Validation -->
            <div class="step-section">
                <h3 class="step-title">Step 2: Price Validation</h3>
                <div id="step2Results"></div>
            </div>

            <!-- Step 3: Coupon & Yields -->
            <div class="step-section">
                <h3 class="step-title">Step 3: Coupon & Yields Screening</h3>
                <div id="step3Results"></div>
            </div>

            <!-- Step 4: Real Metrics -->
            <div class="step-section">
                <h3 class="step-title">Step 4: Real Metrics (Inflation-Adjusted)</h3>
                <div id="step4Results"></div>
            </div>

            <!-- Step 5: Volatility & Credit -->
            <div class="step-section">
                <h3 class="step-title">Step 5: Volatility & Credit Risk</h3>
                <div id="step5Results"></div>
            </div>

            <!-- Step 6: Liquidity -->
            <div class="step-section">
                <h3 class="step-title">Step 6: Liquidity & Fine Print</h3>
                <div id="step6Results"></div>
            </div>

            <!-- Step 7: Decision -->
            <div class="step-section">
                <h3 class="step-title">Step 7: Final Score & Recommendation</h3>
                <div id="decisionBox"></div>
            </div>

            <div id="scoreBreakdown"></div>
        </div>
    </div>

    <script>
        function createCriterion(title, score, detail, formula = null, explanation = null) {
            const scoreText = score === 2 ? '‚úÖ GREEN (2 pts)' : score === 1 ? 'üü° YELLOW (1 pt)' : '‚ùå RED (0 pts)';
            const statusClass = score === 2 ? 'green' : score === 1 ? 'yellow' : 'red';
            const icon = score === 2 ? '‚úÖ' : score === 1 ? '‚ö†Ô∏è' : '‚ùå';

            let html = `
                <div class="criterion ${statusClass}">
                    <div class="criterion-icon">${icon}</div>
                    <div class="criterion-content">
                        <div class="criterion-title">${title}</div>
                        <div class="criterion-detail">${detail}</div>
            `;
            if (formula) {
                html += `<div class="criterion-formula">${formula}</div>`;
            }
            if (explanation) {
                html += `<div class="criterion-detail" style="margin-top: 8px; font-style: italic;">${explanation}</div>`;
            }
            html += `<div class="criterion-score">${scoreText}</div>`;
            html += `</div></div>`;
            return html;
        }

        function evaluateBond() {
            const resultsSection = document.getElementById('resultsSection');
            const errorContainer = document.getElementById('errorContainer');
            errorContainer.innerHTML = '';

            try {
                const bondPrice = parseFloat(document.getElementById('bondPrice').value);
                const faceValue = parseFloat(document.getElementById('faceValue').value);
                const couponRate = parseFloat(document.getElementById('couponRate').value) / 100;
                const yearsToMaturity = parseFloat(document.getElementById('yearsToMaturity').value);
                const ytm = parseFloat(document.getElementById('ytm').value) / 100;
                const currentYield = parseFloat(document.getElementById('currentYield').value) / 100;
                const treasuryYTM = parseFloat(document.getElementById('treasuryYTM').value) / 100;
                const inflation = parseFloat(document.getElementById('inflation').value) / 100;
                const duration = parseFloat(document.getElementById('duration').value);
                const holdingPeriod = parseFloat(document.getElementById('holdingPeriod').value);
                const isCallable = document.getElementById('isCallable').value === 'true';
                const tradingVolume = parseFloat(document.getElementById('tradingVolume').value);
                const creditRating = document.getElementById('creditRating').value;

                if (bondPrice <= 0 || faceValue <= 0 || yearsToMaturity <= 0) {
                    throw new Error('All prices and years must be positive.');
                }

                let totalScore = 0;
                const scores = {};

                // Step 2: Price Validation
                const priceVsPar = (bondPrice - faceValue) / faceValue;
                const priceIsReasonable = Math.abs(priceVsPar) < 0.15;
                const score2 = priceIsReasonable ? 2 : 1;
                totalScore += score2;
                scores.step2 = score2;

                let step2HTML = createCriterion(
                    'Bond Price vs Par',
                    score2,
                    `Price: $${bondPrice}, Par: $${faceValue}, Deviation: ${(priceVsPar * 100).toFixed(2)}%`,
                    `Price vs Par = (${bondPrice} - ${faceValue}) / ${faceValue} = ${(priceVsPar * 100).toFixed(2)}%`,
                    score2 === 2 ? 'Price is reasonably valued (¬±15% of par).' : 'Price shows extreme discount/premium. Investigate.'
                );
                document.getElementById('step2Results').innerHTML = step2HTML;

                // Step 3: Coupon & Yields
                const couponType = document.getElementById('couponType').value;
                const couponIsFixed = couponType === 'fixed';
                const yieldLogic = currentYield <= ytm ? 'normal' : 'premium';
                
                let step3HTML = '';

                // 3a: Coupon Type
                const score3a = couponIsFixed ? 2 : 1;
                totalScore += score3a;
                scores.step3a = score3a;

                step3HTML += createCriterion(
                    'Coupon Type - Predictability',
                    score3a,
                    `Coupon Type: ${couponType === 'fixed' ? 'Fixed (predictable)' : couponType === 'floating' ? 'Floating (uncertain)' : 'Zero-Coupon (no income)'}`,
                    null,
                    couponIsFixed ? 'Fixed coupons provide stable, predictable cash flow.' : 'Floating/Zero coupons add uncertainty or require reinvestment.'
                );

                // 3b: YTM vs Current Yield logic
                const score3b = yieldLogic === 'normal' ? 2 : 1;
                totalScore += score3b;
                scores.step3b = score3b;

                step3HTML += createCriterion(
                    'Yield Relationship',
                    score3b,
                    `Current Yield: ${(currentYield * 100).toFixed(2)}%, YTM: ${(ytm * 100).toFixed(2)}%`,
                    null,
                    yieldLogic === 'normal' ? 'Discount bond: CY < YTM (capital appreciation likely).' : 'Premium bond: CY > YTM (capital loss likely). Acceptable if holding to maturity.'
                );

                document.getElementById('step3Results').innerHTML = step3HTML;

                // Step 4: Real Metrics
                const realYield = ytm - inflation;
                const score4 = realYield > 0.01 ? 2 : realYield > 0 ? 1 : 0;
                totalScore += score4;
                scores.step4 = score4;

                let step4HTML = createCriterion(
                    'Real Yield (Inflation-Adjusted)',
                    score4,
                    `Real Yield: ${(realYield * 100).toFixed(2)}% (YTM ${(ytm * 100).toFixed(2)}% - Inflation ${(inflation * 100).toFixed(2)}%)`,
                    `Real Yield ‚âà YTM - Inflation = ${(ytm * 100).toFixed(2)}% - ${(inflation * 100).toFixed(2)}% = ${(realYield * 100).toFixed(2)}%`,
                    score4 === 2 ? 'Strong positive real yield. Purchasing power preserved.' : score4 === 1 ? 'Marginal real yield. Monitor inflation.' : 'Negative real yield. You lose purchasing power.'
                );
                document.getElementById('step4Results').innerHTML = step4HTML;

                // Step 5: Volatility & Credit (3 criteria, highest weight)
                let step5HTML = '';

                // 5a: Duration Risk
                const durationSafe = duration <= holdingPeriod;
                const score5a = durationSafe ? 2 : 1;
                totalScore += score5a;
                scores.step5a = score5a;

                step5HTML += createCriterion(
                    'Duration Risk',
                    score5a,
                    `Duration: ${duration.toFixed(2)} yrs, Holding Period: ${holdingPeriod} yrs`,
                    null,
                    durationSafe ? 'Duration ‚â§ holding period. Interest rate risk mitigated.' : 'Duration exceeds holding period. Rising rates could hurt if you sell early.'
                );

                // 5b: Credit Spread
                const creditSpread = ytm - treasuryYTM;
                const minSpreadThreshold = creditRating === 'BBB' ? 0.015 : creditRating === 'BB' ? 0.04 : 0.008;
                const score5b = creditSpread >= minSpreadThreshold ? 2 : creditSpread > 0 ? 1 : 0;
                totalScore += score5b;
                scores.step5b = score5b;

                step5HTML += createCriterion(
                    'Credit Spread vs Rating',
                    score5b,
                    `Spread: ${(creditSpread * 100).toFixed(2)}% (${creditRating}-rated, threshold: ${(minSpreadThreshold * 100).toFixed(1)}%)`,
                    `Spread = YTM ${(ytm * 100).toFixed(2)}% - Treasury ${(treasuryYTM * 100).toFixed(2)}% = ${(creditSpread * 100).toFixed(2)}%`,
                    score5b === 2 ? 'Adequate compensation for credit risk.' : score5b === 1 ? 'Minimal spread. Limited compensation.' : 'Insufficient spread. Unattractive risk-return.'
                );

                // 5c: Callability
                const callabilityRisk = isCallable && ytm < 0.05;
                const score5c = !isCallable ? 2 : !callabilityRisk ? 1 : 0;
                totalScore += score5c;
                scores.step5c = score5c;

                step5HTML += createCriterion(
                    'Callability Risk',
                    score5c,
                    `Callable: ${isCallable ? 'Yes' : 'No'}, YTM: ${(ytm * 100).toFixed(2)}%`,
                    null,
                    isCallable && ytm < 0.05 ? 'Callable at low rates. Issuer will refinance. Your upside capped.' : 'Safe from early redemption.'
                );

                document.getElementById('step5Results').innerHTML = step5HTML;

                // Step 6: Liquidity (lower weight)
                let step6HTML = '';

                // 6a: Liquidity
                const liquidityAdequate = tradingVolume >= 1;
                const score6a = liquidityAdequate ? 2 : 1;
                totalScore += score6a;
                scores.step6a = score6a;

                step6HTML += createCriterion(
                    'Daily Trading Volume',
                    score6a,
                    `Daily Volume: $${tradingVolume.toFixed(1)}M`,
                    null,
                    liquidityAdequate ? 'Sufficient liquidity for easy exit.' : 'Poor liquidity. Commit to holding to maturity.'
                );

                document.getElementById('step6Results').innerHTML = step6HTML;

                // Step 7: Final Decision
                let recommendation = '';
                let decisionClass = '';
                let decisionIcon = '';

                if (totalScore >= 12) {
                    recommendation = 'GOOD BUY';
                    decisionClass = 'buy';
                    decisionIcon = '‚úÖ';
                } else if (totalScore >= 8) {
                    recommendation = 'HOLD / WATCH';
                    decisionClass = 'hold';
                    decisionIcon = '‚è∏Ô∏è';
                } else {
                    recommendation = 'REJECT / AVOID';
                    decisionClass = 'reject';
                    decisionIcon = '‚ùå';
                }

                const decisionHTML = `
                    <div class="decision-box ${decisionClass}">
                        <p class="decision-title">${decisionIcon} ${recommendation}</p>
                        <p class="decision-subtitle">
                            ${recommendation === 'GOOD BUY' ? 'Bond passes most critical checks. Recommended for purchase (allocate ‚â§5% of portfolio).' : 
                              recommendation === 'HOLD / WATCH' ? 'Bond shows potential but has some concerns. Monitor before purchase or hold if already owned.' : 
                              'Bond fails multiple checks. Search for better opportunities.'}
                        </p>
                    </div>
                `;

                document.getElementById('decisionBox').innerHTML = decisionHTML;

                // Score Breakdown
                const scoreBreakdownHTML = `
                    <div class="score-breakdown">
                        <div class="score-breakdown-item">
                            <span>Step 2: Price Validation</span>
                            <span>${scores.step2} pts</span>
                        </div>
                        <div class="score-breakdown-item">
                            <span>Step 3a: Coupon Type</span>
                            <span>${scores.step3a} pts</span>
                        </div>
                        <div class="score-breakdown-item">
                            <span>Step 3b: Yield Relationship</span>
                            <span>${scores.step3b} pts</span>
                        </div>
                        <div class="score-breakdown-item">
                            <span>Step 4: Real Yield</span>
                            <span>${scores.step4} pts</span>
                        </div>
                        <div class="score-breakdown-item">
                            <span>Step 5a: Duration Risk (2x weight)</span>
                            <span>${scores.step5a} pts</span>
                        </div>
                        <div class="score-breakdown-item">
                            <span>Step 5b: Credit Spread (2x weight)</span>
                            <span>${scores.step5b} pts</span>
                        </div>
                        <div class="score-breakdown-item">
                            <span>Step 5c: Callability (2x weight)</span>
                            <span>${scores.step5c} pts</span>
                        </div>
                        <div class="score-breakdown-item">
                            <span>Step 6a: Liquidity</span>
                            <span>${scores.step6a} pts</span>
                        </div>
                        <div class="score-breakdown-item score-breakdown-total">
                            <span>TOTAL SCORE</span>
                            <span>${totalScore}/14</span>
                        </div>
                    </div>
                `;

                document.getElementById('scoreBreakdown').innerHTML = scoreBreakdownHTML;
                document.getElementById('totalScore').textContent = totalScore;

                // Metrics Summary
                const metricsHTML = `
                    <div class="metrics-grid">
                        <div class="metric">
                            <div class="metric-label">Current Yield</div>
                            <div class="metric-value">${(currentYield * 100).toFixed(2)}%</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Yield to Maturity</div>
                            <div class="metric-value">${(ytm * 100).toFixed(2)}%</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Real Yield</div>
                            <div class="metric-value">${(realYield * 100).toFixed(2)}%</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Credit Spread</div>
                            <div class="metric-value">${(creditSpread * 100).toFixed(2)}%</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Duration</div>
                            <div class="metric-value">${duration.toFixed(2)} yrs</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Price vs Par</div>
                            <div class="metric-value">${(priceVsPar * 100).toFixed(2)}%</div>
                        </div>
                    </div>
                `;

                document.getElementById('metricsContainer').innerHTML = metricsHTML;
                resultsSection.style.display = 'block';

            } catch (error) {
                errorContainer.innerHTML = `<div class="error-message">${error.message}</div>`;
                resultsSection.style.display = 'block';
            }
        }
    </script>
</body>
</html>
