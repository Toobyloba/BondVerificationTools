<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BondMetrics Pro - Valuation Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/global.css">
    <style>
        .page-header {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            color: white;
            padding: 3rem 0;
            margin-bottom: 3rem;
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
            text-align: center;
        }

        .valuation-hero {
            background: white;
            border-radius: var(--radius-lg);
            padding: 2.5rem;
            box-shadow: var(--shadow-lg);
            margin-bottom: 3rem;
            border: 1px solid var(--border);
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 2rem;
            text-align: center;
        }

        .hero-metric .label {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .hero-metric .value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .hero-metric .sub {
            font-size: 0.8125rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        .step-card {
            background: white;
            padding: 1.5rem;
            border-radius: var(--radius);
            margin-bottom: 1rem;
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        .step-card.active {
            border-left: 6px solid var(--primary);
            box-shadow: var(--shadow);
        }

        .risk-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 99px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .risk-badge.pass {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
        }

        .risk-badge.caution {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
        }

        .risk-badge.fail {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }

        .decision-card {
            padding: 3rem;
            border-radius: var(--radius-lg);
            text-align: center;
            color: white;
            margin-top: 3rem;
        }

        .decision-card.BUY {
            background: var(--success);
        }

        .decision-card.CAUTION {
            background: var(--warning);
        }

        .decision-card.AVOID {
            background: var(--error);
        }
    </style>
</head>

<body>
    <script src="js/navigation.js"></script>

    <div class="container" style="padding-top: 3rem;">
        <div class="grid grid-cols-3">
            <div class="card">
                <h3 class="card-title">Bond Basics</h3>
                <div class="form-group">
                    <label>Current Market Price - $</label>
                    <input type="number" id="bondPrice" value="950">
                </div>
                <div class="form-group">
                    <label>Face Value (Par) - $</label>
                    <input type="number" id="faceValue" value="1000">
                </div>
                <div class="form-group">
                    <label>Coupon Rate - %</label>
                    <input type="number" id="couponRate" value="5">
                </div>
                <div class="form-group">
                    <label>Maturity (yrs)</label>
                    <input type="number" id="yearsToMaturity" value="10">
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">Yield Parameters</h3>
                <div class="form-group">
                    <label>Market YTM - %</label>
                    <input type="number" id="ytm" value="6">
                </div>
                <div class="form-group">
                    <label>Your Required Yield - %</label>
                    <input type="number" id="requiredYield" value="5.5">
                </div>
                <div class="form-group">
                    <label>Payment Frequency</label>
                    <select id="frequency">
                        <option value="1">Annual</option>
                        <option value="2" selected>Semi-Annual</option>
                        <option value="4">Quarterly</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Credit Rating</label>
                    <select id="creditRating">
                        <option>AAA</option>
                        <option>AA</option>
                        <option>A</option>
                        <option selected>BBB</option>
                        <option>BB</option>
                        <option>B</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">Risk Environment</h3>
                <div class="form-group">
                    <label>Is Bond Callable?</label>
                    <select id="isCallable">
                        <option value="false">No</option>
                        <option value="true">Yes</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Liquidity Profile</label>
                    <select id="liquidity">
                        <option value="tight">High (Tight Spread)</option>
                        <option value="moderate" selected>Moderate</option>
                        <option value="wide">Low (Wide Spread)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>FX Risk Profile</label>
                    <select id="currencyRisk">
                        <option value="none">Domestic (None)</option>
                        <option value="low">Low FX Exposure</option>
                        <option value="high">High FX Exposure</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Holding Strategy</label>
                    <select id="holdingPlan">
                        <option value="maturity">Hold to Maturity</option>
                        <option value="early">Active Trading</option>
                    </select>
                </div>
            </div>
        </div>

        <button onclick="evaluateBond()" class="btn btn-primary"
            style="margin-top: 2rem; width: 100%; height: 60px; font-size: 1.125rem;">
            Calculate Intrinsic Value
        </button>

        <div class="results-section" id="resultsSection" style="display: none;">
            <div id="valuationHero" class="valuation-hero animate-fade-in"></div>

            <div id="errorContainer"></div>

            <div class="grid grid-cols-2" style="gap: 2rem;">
                <div>
                    <h3
                        style="margin-bottom: 1.5rem; color: var(--text-muted); font-size: 0.875rem; text-transform: uppercase;">
                        Performance Steps</h3>
                    <div id="stepsResults"></div>
                </div>
                <div>
                    <h3
                        style="margin-bottom: 1.5rem; color: var(--text-muted); font-size: 0.875rem; text-transform: uppercase;">
                        Risk Environment</h3>
                    <div id="risksResults"></div>
                </div>
            </div>

            <div id="finalDecision"></div>
        </div>

        <div style="height: 100px;"></div>
    </div>

    <script src="js/api-client.js"></script>
    <script>
        async function evaluateBond() {
            const resultsSection = document.getElementById('resultsSection');
            const errorContainer = document.getElementById('errorContainer');
            const btn = document.querySelector('button[onclick="evaluateBond()"]');

            errorContainer.innerHTML = '';
            btn.disabled = true;
            btn.innerHTML = '<span>Discounting Cash Flows...</span>';

            try {
                const data = {
                    bondPrice: parseFloat(document.getElementById('bondPrice').value),
                    faceValue: parseFloat(document.getElementById('faceValue').value),
                    couponRate: parseFloat(document.getElementById('couponRate').value),
                    yearsToMaturity: parseFloat(document.getElementById('yearsToMaturity').value),
                    ytm: parseFloat(document.getElementById('ytm').value),
                    requiredYield: parseFloat(document.getElementById('requiredYield').value),
                    frequency: document.getElementById('frequency').value,
                    couponType: 'fixed',
                    creditRating: document.getElementById('creditRating').value,
                    isCallable: document.getElementById('isCallable').value === 'true',
                    liquidity: document.getElementById('liquidity').value,
                    currencyRisk: document.getElementById('currencyRisk').value,
                    holdingPlan: document.getElementById('holdingPlan').value
                };

                const result = await BondAPI.evaluateValuation(data);
                const { metrics, risks, recommendation } = result;

                const isCheap = data.bondPrice < metrics.fairPrice;

                // Hero section
                document.getElementById('valuationHero').innerHTML = `
                    <div class="hero-metric">
                        <div class="label">Fair Price</div>
                        <div class="value">$${metrics.fairPrice.toFixed(2)}</div>
                        <div class="sub">At ${data.requiredYield}% requirement</div>
                    </div>
                    <div class="hero-metric">
                        <div class="label">Market Price</div>
                        <div class="value">$${data.bondPrice.toFixed(2)}</div>
                        <div class="sub">Current quoting price</div>
                    </div>
                    <div class="hero-metric">
                        <div class="label">Valuation Delta</div>
                        <div class="value" style="color: ${isCheap ? 'var(--success)' : 'var(--error)'}">${isCheap ? '-' : '+'}${Math.abs(metrics.priceVsFair).toFixed(2)}%</div>
                        <div class="sub">${isCheap ? 'Undervalued' : 'Overvalued'}</div>
                    </div>
                `;

                // Steps results
                document.getElementById('stepsResults').innerHTML = `
                    <div class="step-card active">
                        <div style="font-weight: 700; margin-bottom: 0.5rem;">Step 1 & 2: Cash Flow & Yield</div>
                        <div style="font-size: 0.875rem; color: var(--text-muted);">
                            Annual Income: $${metrics.annualCoupon.toFixed(2)}<br>
                            Current Yield: ${metrics.currentYield.toFixed(2)}%
                        </div>
                    </div>
                    <div class="step-card active">
                        <div style="font-weight: 700; margin-bottom: 0.5rem;">Step 3 & 4: Valuation Signal</div>
                        <div style="font-size: 0.875rem; color: var(--text-muted);">
                            Market YTM: ${data.ytm}%<br>
                            Signal: ${isCheap ? 'BUY (Cheap)' : 'AVOID (Expensive)'}
                        </div>
                    </div>
                `;

                // Risks results
                document.getElementById('risksResults').innerHTML = risks.map(r => `
                    <div class="step-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <span style="font-weight: 700;">${r.name}</span>
                            <span class="risk-badge ${r.status}">${r.status.toUpperCase()}</span>
                        </div>
                        <div style="font-size: 0.8125rem; color: var(--text-muted);">${r.detail}</div>
                    </div>
                `).join('');

                // Final decision
                document.getElementById('finalDecision').innerHTML = `
                    <div class="decision-card ${recommendation} animate-fade-in">
                        <h2 style="color: white; font-size: 2.5rem; margin-bottom: 0.5rem;">${recommendation}</h2>
                        <p style="opacity: 0.9;">Professional Verdict based on DCF Model and Risk Filters</p>
                    </div>
                `;

                resultsSection.style.display = 'block';
                resultsSection.scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                errorContainer.innerHTML = `<div class="badge badge-error" style="display: block; padding: 1rem;">Server Error: ${error.message}</div>`;
                resultsSection.style.display = 'block';
            } finally {
                btn.disabled = false;
                btn.innerText = 'Calculate Intrinsic Value';
            }
        }
    </script>
    <script src="js/footer.js"></script>
</body>

</html>